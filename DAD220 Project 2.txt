USE QuantigrationUpdates;

SELECT Customers.State, COUNT(RMA.RMAID) AS Returns, COUNT(Orders.OrderID) AS Sales, ((COUNT(RMA.RMAID)/COUNT(Orders.OrderID))*100) AS ReturnPercent
FROM Customers
INNER JOIN Orders
ON Customers.CustomerID = Orders.CustomerID
LEFT JOIN RMA
ON Orders.OrderID = RMA.OrderID
GROUP BY Customers.State
ORDER BY COUNT(RMA.RMAID) DESC;

SELECT Orders.SKU, Orders.Description, COUNT(Orders.OrderID) AS Sales, COUNT(RMA.RMAID) AS Returns, ((COUNT(RMA.RMAID)/COUNT(Orders.OrderID))*100) AS ReturnPercent
FROM Orders
LEFT JOIN RMA
ON Orders.OrderID = RMA.OrderID
GROUP BY Orders.SKU
ORDER BY ((COUNT(RMA.RMAID)/COUNT(Orders.OrderID))*100) DESC;

SELECT * 
FROM Orders   
INTO OUTFILE '/home/codio/workspace/NewOrders.csv' 
FIELDS TERMINATED BY ',' 
LINES TERMINATED BY '\r\n';

SELECT * 
FROM RMA  
INTO OUTFILE '/home/codio/workspace/NewRMA.csv' 
FIELDS TERMINATED BY ',' 
LINES TERMINATED BY '\r\n';

SELECT * 
FROM Customers 
INTO OUTFILE '/home/codio/workspace/NewCustomers.csv' 
FIELDS TERMINATED BY ',' 
LINES TERMINATED BY '\r\n';
